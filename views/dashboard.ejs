<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLAWNET_C2C_HQ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&display=swap');
        body { font-family: 'Fira Code', monospace; scrollbar-width: thin; scrollbar-color: #27272a #09090b; overflow: hidden; }
        .terminal-glow { box-shadow: 0 0 20px rgba(34, 197, 94, 0.1); }
        .tab-btn.active { border-bottom-color: #22c55e; color: #f4f4f5; background: #18181b; }
    </style>
</head>
<body class="bg-[#09090b] text-zinc-400 h-screen flex flex-col">
    <header class="border-b border-zinc-800 p-4 flex justify-between items-center bg-[#09090b]">
        <h1 class="text-green-500 font-bold tracking-tighter text-xl italic">ðŸ¦ž CLAWNET_C2C <span class="text-zinc-600 text-xs font-mono not-italic">v3.1_ATOMIC</span></h1>
        <div id="connection-status" class="flex items-center gap-2 text-[10px] uppercase tracking-widest text-zinc-500">
            <span id="status-dot" class="w-2 h-2 bg-red-500 rounded-full"></span> <span id="status-text">OFFLINE</span>
        </div>
    </header>

    <nav class="flex border-b border-zinc-800 bg-[#0c0c0e]">
        <button onclick="showTab('fleet')" class="tab-btn active px-6 py-3 text-xs font-bold border-r border-zinc-800 hover:bg-zinc-900 transition-all">01_FLEET</button>
        <button onclick="showTab('ops')" class="tab-btn px-6 py-3 text-xs font-bold border-r border-zinc-800 hover:bg-zinc-900 transition-all">02_OPERATIONS</button>
        <button onclick="showTab('intel')" class="tab-btn px-6 py-3 text-xs font-bold border-r border-zinc-800 hover:bg-zinc-900 transition-all">03_INTEL</button>
        <button onclick="showTab('settings')" class="tab-btn px-6 py-3 text-xs font-bold hover:bg-zinc-900 transition-all">04_SETTINGS</button>
    </nav>

    <main class="flex-1 relative overflow-hidden bg-black/20">
        <!-- FLEET TAB -->
        <section id="fleet" class="tab-content h-full p-6 overflow-y-auto">
            <div id="fleet-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Dynamic Content -->
            </div>
        </section>

        <!-- OPERATIONS TAB -->
        <section id="ops" class="tab-content h-full p-6 overflow-y-auto hidden">
            <div class="bg-zinc-900/50 border border-zinc-800 rounded">
                <table class="w-full text-left text-xs">
                    <thead class="bg-zinc-950 text-zinc-600 uppercase text-[10px] border-b border-zinc-800">
                        <tr>
                            <th class="p-4">Task_ID</th>
                            <th class="p-4">Agent</th>
                            <th class="p-4">Command</th>
                            <th class="p-4">Status</th>
                        </tr>
                    </thead>
                    <tbody id="ops-body"></tbody>
                </table>
            </div>
        </section>

        <!-- INTEL TAB -->
        <section id="intel" class="tab-content h-full p-6 flex flex-col gap-4 hidden">
            <div id="chat-box" class="flex-1 bg-black/40 border border-zinc-800 rounded p-4 font-mono text-[11px] overflow-y-auto space-y-2"></div>
            <div class="flex gap-2">
                <input type="text" id="master-input" placeholder="Enter command or message..." 
                       class="flex-1 bg-zinc-900 border border-zinc-800 rounded px-4 py-2 text-xs outline-none focus:border-green-600 text-zinc-100 font-mono">
            </div>
        </section>

        <!-- SETTINGS TAB -->
        <section id="settings" class="tab-content h-full p-6 overflow-y-auto hidden">
            <div class="max-w-md bg-zinc-900 border border-zinc-800 p-6 rounded">
                <h3 class="text-zinc-100 font-bold mb-4 uppercase text-sm tracking-widest">Database_Config</h3>
                <div class="space-y-4">
                    <input type="text" placeholder="Supabase URL" class="w-full bg-black border border-zinc-800 rounded p-2 text-xs outline-none">
                    <input type="password" placeholder="Service Key" class="w-full bg-black border border-zinc-800 rounded p-2 text-xs outline-none">
                    <button class="w-full bg-green-600 py-2 rounded text-[10px] font-bold text-black uppercase">Save_State</button>
                </div>
            </div>
        </section>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io({ auth: { token: '<%= secret %>', agent_id: 'master-ui' }, transports: ['websocket'] });
        
        socket.on('connect', () => {
            document.getElementById('status-dot').className = 'w-2 h-2 bg-green-500 rounded-full animate-pulse';
            document.getElementById('status-text').innerText = 'ONLINE';
        });

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.remove('hidden');
            document.querySelector(`[data-tab="${id}"]`).classList.add('active');
        }

        socket.on('fleet_update', (agents) => {
            const grid = document.getElementById('fleet-grid');
            grid.innerHTML = agents.map(a => `
                <div class="bg-zinc-900 border border-zinc-800 p-5 rounded">
                    <h3 class="text-green-500 font-bold mb-1">${a.id}</h3>
                    <div class="text-[10px] text-zinc-600 uppercase mb-4">${a.role}</div>
                    <div class="text-[10px] grid grid-cols-2 gap-2 bg-black/30 p-2 rounded border border-zinc-800">
                        <div>CPU: ${a.specs.cpu}%</div><div>RAM: ${a.specs.ram}%</div>
                    </div>
                </div>
            `).join('');
        });

        socket.on('task_update', (tasks) => {
            const body = document.getElementById('ops-body');
            body.innerHTML = tasks.map(t => `
                <tr class="border-b border-zinc-800/50">
                    <td class="p-4 font-mono text-zinc-600">#${t.id.substring(0,8)}</td>
                    <td class="p-4 font-bold text-zinc-300">${t.agent_id}</td>
                    <td class="p-4 font-mono text-zinc-500">${t.cmd}</td>
                    <td class="p-4"><span class="text-[9px] font-bold ${t.status === 'SUCCESS' ? 'text-green-500' : 'text-zinc-500'}">${t.status}</span></td>
                </tr>
            `).join('');
        });

        const input = document.getElementById('master-input');
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const cmd = input.value;
                if (cmd.startsWith('/')) socket.emit('dispatch', { to: 'all', cmd: cmd });
                else socket.emit('chat', { msg: cmd });
                input.value = '';
            }
        });

        socket.on('chat_update', (msg) => {
            const box = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = "flex gap-4";
            div.innerHTML = `<span class="text-zinc-700">[${new Date(msg.ts).toLocaleTimeString()}]</span> <span class="text-blue-500 font-bold uppercase">${msg.from}:</span> <span class="text-zinc-400">${msg.msg}</span>`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
    </script>
</body>
</html>
